// Hospital Management System Database Schema
// Prisma schema for PostgreSQL

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Core User Management
model User {
  id                String      @id @default(cuid())
  email             String      @unique
  password          String
  firstName         String
  lastName          String
  phone             String?
  avatar            String?
  role              UserRole    @default(PATIENT)
  isActive          Boolean     @default(true)
  lastLogin         DateTime?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  // MFA (Multi-Factor Authentication)
  mfaEnabled        Boolean     @default(false)
  mfaSecret         String?     // TOTP secret
  mfaBackupCodes    String[]    // Backup recovery codes
  mfaMethod         MFAMethod?  @default(TOTP)

  // Security
  failedLoginAttempts Int        @default(0)
  lockedUntil         DateTime?
  passwordChangedAt   DateTime?
  lastPasswordReset   DateTime?

  // Relations
  patient            Patient?
  doctor             Doctor?
  nurse              Nurse?
  receptionist       Receptionist?
  labTechnician      LabTechnician?
  pharmacist         Pharmacist?
  admin              Admin?

  // Audit
  createdBy          String?
  updatedBy          String?

  @@map("users")

  // Indexes for performance
  @@index([email])
  @@index([role])
  @@index([isActive])
  @@index([lastLogin])
  @@index([failedLoginAttempts])
  @@index([lockedUntil])
}

enum MFAMethod {
  TOTP      // Time-based One-Time Password (Google Authenticator, etc.)
  SMS       // SMS-based OTP
  EMAIL     // Email-based OTP
}

enum UserRole {
  SUPERADMIN
  ADMIN
  DOCTOR
  NURSE
  RECEPTIONIST
  LAB_TECHNICIAN
  PHARMACIST
  PATIENT
}

// Patient Management
model Patient {
  id                String   @id @default(cuid())
  userId            String   @unique
  mrn               String   @unique // Medical Record Number
  dateOfBirth       DateTime
  gender            Gender
  bloodType         BloodType?
  emergencyContact  String?
  emergencyPhone    String?
  address           Json?    // Structured address
  insuranceInfo     Json?    // Insurance details
  medicalHistory    Json?    // Medical history summary
  allergies         String[]
  currentMedications String[]
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  user              User     @relation(fields: [userId], references: [id])
  appointments      Appointment[]
  medicalRecords    MedicalRecord[]
  prescriptions     Prescription[]
  bills             Bill[]
  labTests          LabTest[]
  radiologyTests    RadiologyTest[]
  emergencyVisits   EmergencyVisit[]
  opdVisits         OPDVisit[]
  surgeries         Surgery[]

  @@map("patients")

  // Indexes for performance
  @@index([mrn])
  @@index([userId])
  @@index([dateOfBirth])
  @@index([gender])
  @@index([bloodType])
  @@index([createdAt])
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum BloodType {
  A_POSITIVE
  A_NEGATIVE
  B_POSITIVE
  B_NEGATIVE
  AB_POSITIVE
  AB_NEGATIVE
  O_POSITIVE
  O_NEGATIVE
}

// Doctor Management
model Doctor {
  id                String   @id @default(cuid())
  userId            String   @unique
  licenseNumber     String   @unique
  specialization    String
  department        String
  experienceYears   Int      @default(0)
  qualifications    String[]
  schedule          Json?    // Weekly schedule
  isAvailable       Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  user              User     @relation(fields: [userId], references: [id])
  appointments      Appointment[]
  medicalRecords    MedicalRecord[]
  prescriptions     Prescription[]
  surgeries         Surgery[]

  @@map("doctors")
}

// Appointment Management
model Appointment {
  id                String            @id @default(cuid())
  patientId         String
  doctorId          String
  appointmentDate   DateTime
  duration          Int               @default(30) // minutes
  type              AppointmentType
  status            AppointmentStatus @default(SCHEDULED)
  reason            String?
  notes             String?
  roomNumber        String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  // Relations
  patient           Patient           @relation(fields: [patientId], references: [id])
  doctor            Doctor            @relation(fields: [doctorId], references: [id])

  @@unique([doctorId, appointmentDate])
  @@map("appointments")

  // Indexes for performance
  @@index([patientId])
  @@index([doctorId])
  @@index([appointmentDate])
  @@index([status])
  @@index([type])
  @@index([createdAt])
}

enum AppointmentType {
  CONSULTATION
  FOLLOW_UP
  EMERGENCY
  PROCEDURE
  CHECKUP
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
}

// Medical Records
model MedicalRecord {
  id                String   @id @default(cuid())
  patientId         String
  doctorId          String
  visitDate         DateTime
  chiefComplaint    String
  historyOfPresentIllness String?
  physicalExamination Json?   // Structured exam findings
  diagnosis         String[]
  treatmentPlan     String?
  medications       Json?    // Prescribed medications
  followUpDate      DateTime?
  notes             String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  patient           Patient  @relation(fields: [patientId], references: [id])
  doctor            Doctor   @relation(fields: [doctorId], references: [id])

  @@map("medical_records")
}

// Pharmacy Management
model Medication {
  id                String         @id @default(cuid())
  name              String
  genericName       String?
  brandName         String?
  dosageForm        DosageForm
  strength          String
  manufacturer      String?
  batchNumber       String?
  expiryDate        DateTime?
  stockQuantity     Int            @default(0)
  reorderLevel      Int            @default(10)
  unitPrice         Decimal        @db.Decimal(10,2)
  category          String?
  requiresPrescription Boolean      @default(true)
  isActive          Boolean        @default(true)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  // Relations
  prescriptions     Prescription[]
  inventoryLogs     InventoryLog[]

  @@map("medications")
}

enum DosageForm {
  TABLET
  CAPSULE
  SYRUP
  INJECTION
  CREAM
  DROPS
  INHALER
  PATCH
}

// Prescription Management
model Prescription {
  id                String             @id @default(cuid())
  patientId         String
  doctorId          String
  medicationId      String
  dosage            String
  frequency         String
  duration          Int                // days
  quantity          Int
  instructions      String?
  status            PrescriptionStatus @default(ACTIVE)
  prescribedDate    DateTime          @default(now())
  dispensedDate     DateTime?
  dispensedBy       String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  // Relations
  patient           Patient            @relation(fields: [patientId], references: [id])
  doctor            Doctor             @relation(fields: [doctorId], references: [id])
  medication        Medication         @relation(fields: [medicationId], references: [id])

  @@map("prescriptions")
}

enum PrescriptionStatus {
  ACTIVE
  COMPLETED
  CANCELLED
  EXPIRED
}

// Laboratory Management
model LabTestCatalog {
  id                String         @id @default(cuid())
  testCode          String         @unique
  testName          String
  category          String
  subcategory       String?
  department        LabDepartment
  specimenType      SpecimenType
  containerType     String
  volumeRequired    String?        // e.g., "5ml", "10ml"
  specialInstructions String?
  turnaroundTime    Int            // hours
  referenceRange    Json?          // Age/sex specific ranges
  units             String?
  method            String?
  cost              Decimal        @db.Decimal(10,2)
  isActive          Boolean        @default(true)
  requiresApproval  Boolean        @default(false)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  // Relations
  tests             LabTest[]

  @@map("lab_test_catalog")

  // Indexes
  @@index([testCode])
  @@index([category])
  @@index([department])
  @@index([isActive])
}

model LabTest {
  id                String         @id @default(cuid())
  patientId         String
  testCatalogId     String
  orderNumber       String         @unique
  status            LabTestStatus  @default(ORDERED)
  priority          LabPriority    @default(ROUTINE)
  orderedDate       DateTime       @default(now())
  orderedBy         String
  clinicalInfo      String?        // Clinical indication
  diagnosis         String?        // Suspected diagnosis
  urgent            Boolean        @default(false)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  // Relations
  patient           Patient        @relation(fields: [patientId], references: [id])
  testCatalog       LabTestCatalog @relation(fields: [testCatalogId], references: [id])
  samples           LabSample[]
  results           LabResult[]
  reports           LabReport[]

  @@map("lab_tests")

  // Indexes
  @@index([patientId])
  @@index([testCatalogId])
  @@index([status])
  @@index([priority])
  @@index([orderedDate])
  @@index([urgent])
}

model LabSample {
  id                String         @id @default(cuid())
  labTestId         String
  sampleId          String         @unique // Barcode/sample ID
  specimenType      SpecimenType
  collectionMethod  CollectionMethod
  collectionDate    DateTime       @default(now())
  collectedBy       String
  collectionSite    String?        // e.g., "Left arm", "Right hand"
  volume            String?        // Actual volume collected
  condition         SampleCondition @default(GOOD)
  storageLocation   String?        // Freezer/fridge location
  storageTemp       String?        // e.g., "-80°C", "4°C"
  expiryDate        DateTime?
  notes             String?
  rejected          Boolean        @default(false)
  rejectionReason   String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  // Relations
  labTest           LabTest        @relation(fields: [labTestId], references: [id])
  results           LabResult[]

  @@map("lab_samples")

  // Indexes
  @@index([labTestId])
  @@index([sampleId])
  @@index([specimenType])
  @@index([collectionDate])
  @@index([rejected])
}

model LabResult {
  id                String         @id @default(cuid())
  labTestId         String
  labSampleId       String?
  parameter         String         // Test parameter name
  value             String         // Result value
  units             String?
  referenceRange    String?
  flag              ResultFlag?    // H, L, HH, LL, etc.
  status            ResultStatus   @default(PRELIMINARY)
  performedBy       String
  performedDate     DateTime       @default(now())
  verifiedBy        String?
  verifiedDate      DateTime?
  instrument        String?        // Equipment used
  method            String?
  notes             String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  // Relations
  labTest           LabTest        @relation(fields: [labTestId], references: [id])
  labSample         LabSample?     @relation(fields: [labSampleId], references: [id])

  @@map("lab_results")

  // Indexes
  @@index([labTestId])
  @@index([labSampleId])
  @@index([parameter])
  @@index([status])
  @@index([performedDate])
}

model LabQualityControl {
  id                String         @id @default(cuid())
  testParameter     String
  controlLot        String
  controlLevel      QCLevel
  expectedValue     String
  expectedRange     String
  actualValue       String
  performedBy       String
  performedDate     DateTime       @default(now())
  instrument        String
  status            QCStatus
  notes             String?
  correctiveAction  String?
  createdAt         DateTime       @default(now())

  @@map("lab_quality_control")

  // Indexes
  @@index([testParameter])
  @@index([controlLot])
  @@index([performedDate])
  @@index([status])
}

model LabReagent {
  id                String         @id @default(cuid())
  name              String
  catalogNumber     String?
  manufacturer      String
  lotNumber         String
  expiryDate        DateTime
  receivedDate      DateTime       @default(now())
  quantity          Int
  unit              String         // e.g., "vials", "bottles"
  storageCondition  String?        // e.g., "2-8°C", "-20°C"
  cost              Decimal        @db.Decimal(10,2)
  supplier          String?
  status            ReagentStatus  @default(ACTIVE)
  minStockLevel     Int            @default(1)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  @@map("lab_reagents")

  // Indexes
  @@index([name])
  @@index([lotNumber])
  @@index([expiryDate])
  @@index([status])
}

model LabEquipment {
  id                String         @id @default(cuid())
  name              String
  model             String
  serialNumber      String         @unique
  manufacturer      String
  installationDate  DateTime
  warrantyExpiry    DateTime?
  lastCalibration   DateTime?
  nextCalibration   DateTime?
  status            EquipmentStatus @default(ACTIVE)
  location          String
  maintenanceSchedule String?      // e.g., "Monthly", "Quarterly"
  lastMaintenance   DateTime?
  nextMaintenance   DateTime?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  @@map("lab_equipment")

  // Indexes
  @@index([serialNumber])
  @@index([status])
  @@index([nextCalibration])
  @@index([nextMaintenance])
}

model LabReport {
  id                String         @id @default(cuid())
  labTestId         String
  reportNumber      String         @unique
  reportType        ReportType     @default(FINAL)
  generatedDate     DateTime       @default(now())
  generatedBy       String
  approvedBy        String?
  approvedDate      DateTime?
  filePath          String         // PDF file path
  fileSize          Int?           // bytes
  checksum          String?        // For integrity verification
  status            ReportStatus   @default(GENERATED)
  deliveryMethod    DeliveryMethod?
  deliveredDate     DateTime?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  // Relations
  labTest           LabTest        @relation(fields: [labTestId], references: [id])

  @@map("lab_reports")

  // Indexes
  @@index([labTestId])
  @@index([reportNumber])
  @@index([status])
  @@index([generatedDate])
}

model LISIntegration {
  id                String         @id @default(cuid())
  systemName        String
  systemVersion     String?
  endpoint          String
  apiKey            String         // Encrypted
  isActive          Boolean        @default(true)
  lastSync          DateTime?
  syncStatus        SyncStatus     @default(IDLE)
  errorMessage      String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  @@map("lis_integrations")

  // Indexes
  @@index([systemName])
  @@index([isActive])
  @@index([lastSync])
}

enum LabTestStatus {
  ORDERED
  SAMPLE_COLLECTED
  RECEIVED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  REJECTED
}

enum LabDepartment {
  CHEMISTRY
  HEMATOLOGY
  MICROBIOLOGY
  IMMUNOLOGY
  ENDOCRINOLOGY
  TOXICOLOGY
  MOLECULAR
  CYTOLOGY
  HISTOPATHOLOGY
}

enum SpecimenType {
  BLOOD
  URINE
  STOOL
  SPUTUM
  CSF
  SYNOVIAL_FLUID
  PLEURAL_FLUID
  PERITONEAL_FLUID
  SWAB
  TISSUE
  OTHER
}

enum CollectionMethod {
  VENIPUNCTURE
  FINGERSTICK
  HEELSTICK
  URINE_COLLECTION
  STOOL_COLLECTION
  SWAB
  ASPIRATION
  BIOPSY
}

enum SampleCondition {
  GOOD
  HEMOLYZED
  CLOTTED
  INSUFFICIENT
  CONTAMINATED
  LIPIDIC
  ICTERIC
}

enum LabPriority {
  STAT
  URGENT
  ROUTINE
}

enum ResultFlag {
  NORMAL
  HIGH
  LOW
  CRITICAL_HIGH
  CRITICAL_LOW
  ABNORMAL
}

enum ResultStatus {
  PRELIMINARY
  FINAL
  AMENDED
  CORRECTED
}

enum QCLevel {
  LEVEL_1
  LEVEL_2
  LEVEL_3
}

enum QCStatus {
  PASS
  FAIL
  WARNING
  INVALID
}

enum ReagentStatus {
  ACTIVE
  EXPIRED
  DEPLETED
  QUARANTINED
  DISCARDED
}

enum EquipmentStatus {
  ACTIVE
  MAINTENANCE
  CALIBRATION
  OUT_OF_ORDER
  DECOMMISSIONED
}

enum ReportType {
  PRELIMINARY
  FINAL
  AMENDED
  CORRECTED
}

enum ReportStatus {
  GENERATED
  APPROVED
  PRINTED
  DELIVERED
  ARCHIVED
}

enum DeliveryMethod {
  EMAIL
  FAX
  PRINT
  PORTAL
  API
}

enum SyncStatus {
  IDLE
  SYNCING
  SUCCESS
  FAILED
}

// Radiology Management
model RadiologyTest {
  id                String               @id @default(cuid())
  patientId         String
  testName          String
  testCode          String
  modality          RadiologyModality
  status            RadiologyTestStatus  @default(ORDERED)
  orderedDate       DateTime             @default(now())
  orderedBy         String
  scheduledDate     DateTime?
  performedDate     DateTime?
  performedBy       String?
  reportDate        DateTime?
  findings          String?
  impression        String?
  recommendations   String?
  images            String[]             // File paths/URLs
  urgent            Boolean              @default(false)
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt

  // Relations
  patient           Patient              @relation(fields: [patientId], references: [id])

  @@map("radiology_tests")
}

enum RadiologyModality {
  XRAY
  CT
  MRI
  ULTRASOUND
  MAMMOGRAPHY
  DEXA
}

enum RadiologyTestStatus {
  ORDERED
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

// Billing & Invoicing
model Bill {
  id                String         @id @default(cuid())
  patientId         String
  billNumber        String         @unique
  billDate          DateTime       @default(now())
  dueDate           DateTime
  status            BillStatus     @default(PENDING)
  subtotal          Decimal        @db.Decimal(10,2)
  taxAmount         Decimal        @db.Decimal(10,2) @default(0)
  discountAmount    Decimal        @db.Decimal(10,2) @default(0)
  totalAmount       Decimal        @db.Decimal(10,2)
  paidAmount        Decimal        @db.Decimal(10,2) @default(0)
  balanceAmount     Decimal        @db.Decimal(10,2)
  paymentMethod     PaymentMethod?
  paymentDate       DateTime?
  notes             String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  // Relations
  patient           Patient        @relation(fields: [patientId], references: [id])
  items             BillItem[]

  @@map("bills")
}

enum BillStatus {
  PENDING
  PARTIALLY_PAID
  PAID
  OVERDUE
  CANCELLED
}

enum PaymentMethod {
  CASH
  CARD
  INSURANCE
  UPI
  BANK_TRANSFER
  CHEQUE
}

model BillItem {
  id                String   @id @default(cuid())
  billId            String
  itemType          BillItemType
  itemId            String   // Reference to the actual service/test
  description       String
  quantity          Int      @default(1)
  unitPrice         Decimal  @db.Decimal(10,2)
  totalPrice        Decimal  @db.Decimal(10,2)
  createdAt         DateTime @default(now())

  // Relations
  bill              Bill     @relation(fields: [billId], references: [id])

  @@map("bill_items")
}

enum BillItemType {
  CONSULTATION
  PROCEDURE
  LAB_TEST
  RADIOLOGY_TEST
  MEDICATION
  ROOM_CHARGE
  OTHER
}

// Emergency Department
model EmergencyVisit {
  id                String             @id @default(cuid())
  patientId         String
  visitNumber       String             @unique
  arrivalDate       DateTime           @default(now())
  triageLevel       TriageLevel
  chiefComplaint    String
  vitalSigns        Json?              // BP, HR, Temp, etc.
  assessment        String?
  treatment         String?
  disposition       EmergencyDisposition
  dischargeDate     DateTime?
  notes             String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  // Relations
  patient           Patient            @relation(fields: [patientId], references: [id])

  @@map("emergency_visits")
}

enum TriageLevel {
  LEVEL_1 // Resuscitation
  LEVEL_2 // Emergent
  LEVEL_3 // Urgent
  LEVEL_4 // Less Urgent
  LEVEL_5 // Non-Urgent
}

enum EmergencyDisposition {
  DISCHARGED
  ADMITTED
  TRANSFERRED
  LEFT_AGAINST_ADVICE
  EXPIRED
}

// OPD (Outpatient Department) Management
model OPDVisit {
  id                String         @id @default(cuid())
  patientId         String
  doctorId          String
  visitNumber       String         @unique
  visitDate         DateTime       @default(now())
  status            OPDVisitStatus @default(WAITING)
  chiefComplaint    String
  vitals            Json?          // BP, HR, Temp, RR, etc.
  examination       Json?          // Physical examination findings
  diagnosis         String[]
  treatment         String?
  prescriptions     Json?          // Prescribed medications
  followUpDate      DateTime?
  notes             String?
  roomNumber        String?
  priority          PriorityLevel  @default(NORMAL)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  // Relations
  patient           Patient        @relation(fields: [patientId], references: [id])

  @@map("opd_visits")
}

enum OPDVisitStatus {
  WAITING
  IN_PROGRESS
  COMPLETED
  CANCELLED
  REFERRED
}

enum PriorityLevel {
  EMERGENCY
  URGENT
  NORMAL
  ROUTINE
}

// Operating Theater (OT) Management
model OperatingTheater {
  id          String   @id @default(cuid())
  name        String   @unique
  location    String
  type        OTType
  capacity    Int      @default(1) // Number of beds/tables
  equipment   String[] // Available equipment
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  surgeries   Surgery[]

  @@map("operating_theaters")
}

model Surgery {
  id                String           @id @default(cuid())
  patientId         String
  surgeonId         String
  otId              String
  surgeryNumber     String           @unique
  procedureName     String
  procedureCode     String?
  scheduledDate     DateTime
  actualStartTime   DateTime?
  actualEndTime     DateTime?
  estimatedDuration Int              // minutes
  actualDuration    Int?             // minutes
  status            SurgeryStatus    @default(SCHEDULED)
  priority          SurgeryPriority  @default(ELECTIVE)
  anesthesiaType    AnesthesiaType?
  assistants         String[]         // Assistant doctors
  nurses            String[]         // OT nurses
  equipment         String[]         // Required equipment
  preOpNotes        Json?            // Pre-operative notes
  intraOpNotes      Json?            // Intra-operative notes
  postOpNotes       Json?            // Post-operative notes
  complications     String?
  outcome           SurgeryOutcome?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  // Relations
  patient           Patient          @relation(fields: [patientId], references: [id])
  surgeon           Doctor           @relation(fields: [surgeonId], references: [id])
  operatingTheater  OperatingTheater @relation(fields: [otId], references: [id])

  @@map("surgeries")
}

enum OTType {
  GENERAL
  CARDIAC
  NEURO
  ORTHOPEDIC
  PEDIATRIC
  GYNECOLOGY
  UROLOGY
  OPHTHALMOLOGY
}

enum SurgeryStatus {
  SCHEDULED
  PREPARING
  IN_PROGRESS
  COMPLETED
  CANCELLED
  POSTPONED
}

enum SurgeryPriority {
  EMERGENCY
  URGENT
  ELECTIVE
}

enum AnesthesiaType {
  GENERAL
  SPINAL
  EPIDURAL
  LOCAL
  SEDATION
}

enum SurgeryOutcome {
  SUCCESSFUL
  COMPLICATIONS
  UNSUCCESSFUL
  DEATH
}

// Blood Bank Management
model BloodDonation {
  id                String           @id @default(cuid())
  donorId           String
  donationDate      DateTime         @default(now())
  bloodType         BloodType
  quantity          Decimal          @db.Decimal(5,2) // in ml
  donationType      DonationType
  status            DonationStatus   @default(COLLECTED)
  screeningResult   ScreeningResult?
  expiryDate        DateTime
  notes             String?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  @@map("blood_donations")
}

enum DonationType {
  WHOLE_BLOOD
  PLATELETS
  PLASMA
  DOUBLE_RED_CELLS
}

enum DonationStatus {
  COLLECTED
  PROCESSED
  QUARANTINED
  RELEASED
  DISCARDED
}

enum ScreeningResult {
  SAFE
  DEFERRED
  REJECTED
}

// Inventory Management
model InventoryLog {
  id                String           @id @default(cuid())
  medicationId      String
  action            InventoryAction
  quantity          Int
  previousStock     Int
  newStock          Int
  reason            String?
  performedBy       String
  batchNumber       String?
  expiryDate        DateTime?
  costPrice         Decimal?         @db.Decimal(10,2)
  createdAt         DateTime         @default(now())

  // Relations
  medication        Medication       @relation(fields: [medicationId], references: [id])

  @@map("inventory_logs")
}

enum InventoryAction {
  RECEIVED
  ISSUED
  ADJUSTED
  EXPIRED
  DAMAGED
}

// Staff Management (simplified)
model Nurse {
  id          String   @id @default(cuid())
  userId      String   @unique
  licenseNumber String @unique
  department  String
  shift       ShiftType
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id])

  @@map("nurses")
}

model Receptionist {
  id          String   @id @default(cuid())
  userId      String   @unique
  department  String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id])

  @@map("receptionists")
}

model LabTechnician {
  id          String   @id @default(cuid())
  userId      String   @unique
  licenseNumber String @unique
  specialties String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id])

  @@map("lab_technicians")
}

model Pharmacist {
  id          String   @id @default(cuid())
  userId      String   @unique
  licenseNumber String @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id])

  @@map("pharmacists")
}

model Admin {
  id          String   @id @default(cuid())
  userId      String   @unique
  department  String
  permissions String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id])

  @@map("admins")
}

enum ShiftType {
  MORNING
  EVENING
  NIGHT
  ROTATING
}

// Audit Logging
model AuditLog {
  id                String   @id @default(cuid())
  userId            String
  action            String   // e.g., "PATIENT_RECORD_ACCESSED", "MEDICAL_RECORD_CREATED"
  resource          String   // e.g., "patients", "medical_records", "prescriptions"
  resourceId        String   // ID of the resource being accessed/modified
  timestamp         DateTime @default(now())
  ipAddress         String?
  userAgent         String?
  details           Json?    // Additional context about the action
  complianceFlags   String[] // e.g., ["HIPAA", "PHI_ACCESS", "GDPR"]
  sessionId         String?  // For tracking user sessions
  success           Boolean  @default(true) // Whether the action succeeded

  @@map("audit_logs")

  // Indexes for performance
  @@index([userId])
  @@index([action])
  @@index([resource])
  @@index([timestamp])
  @@index([complianceFlags])
  @@index([sessionId])
}

// Compliance Monitoring
model ComplianceCheck {
  id                String            @id @default(cuid())
  checkId           String            @unique // e.g., "hipaa-encryption", "gdpr-consent"
  name              String
  description       String
  category          ComplianceCategory
  status            ComplianceStatus
  severity          ComplianceSeverity
  details           String
  recommendations   String[]
  lastChecked       DateTime          @default(now())
  nextCheck         DateTime
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  @@map("compliance_checks")

  // Indexes for performance
  @@index([checkId])
  @@index([category])
  @@index([status])
  @@index([severity])
  @@index([nextCheck])
}

enum ComplianceCategory {
  HIPAA
  GDPR
  GENERAL
}

enum ComplianceStatus {
  PASS
  FAIL
  WARNING
}

enum ComplianceSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

// Data Retention Tracking
model DataRetentionLog {
  id                String   @id @default(cuid())
  tableName         String
  recordId          String
  retentionPeriod   Int      // days
  dataCategory      DataCategory
  deletedAt         DateTime @default(now())
  deletionReason    String   // e.g., "RETENTION_POLICY", "USER_REQUEST"
  deletedBy         String   // user ID who performed deletion

  @@map("data_retention_logs")

  // Indexes for performance
  @@index([tableName])
  @@index([recordId])
  @@index([dataCategory])
  @@index([deletedAt])
}

enum DataCategory {
  PATIENT_DATA
  FINANCIAL
  ADMINISTRATIVE
  AUDIT
}